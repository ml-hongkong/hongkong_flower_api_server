!function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var r={};t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=42)}({42:function(e,t,r){e.exports=r(43)},43:function(e,t){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(){return this.parentNode}function a(e){if(["pending","processing"].indexOf(e.status)>=0&&d3.select(this).append("div").classed("svg-wrapper",!0).append("svg").attr("width",40).attr("height",40).attr("viewBox","10 10 80 80").append("use").attr("xlink:href","#loading").select(n).select(n).append("div").classed("status",!0).text(e.status),"done"===e.status){d3.select(this).append("div").classed("rank-wrapper",!0).selectAll("div.rank").data(e.result.sort(function(e,t){return t.score-e.score}).slice(0,4)).enter().append("div").classed("rank",!0).append("span").text(function(e){return e.class}).select(n).append("span").text(function(e){return e.score.toFixed(2)})}}function i(e){var t=e.toList(),r=d3.select(".list-section").selectAll("div.item").data(t);r.each(function(e){if(["pending","processing"].indexOf(e.status)>=0)$(this).find("div.status").text(e.status);else if("done"===e.status){var t=d3.select(this).select("div.result");t.selectAll("*").remove(),a.bind(t.node(),e)()}}),r.enter().append("div").classed("item",!0).attr("data-id",function(e){return e.image_id}).append("div").classed("image",!0).attr("style",function(e){return"background-image: url("+e.image_url+")"}).append("span").classed("cross",!0).text("âœ•").on("click",function(t,r){e.remove(t.image_id),$(this).closest(".item").remove(),i(e)}).select(n).select(n).append("div").classed("result",!0).each(a),r.exit().remove()}function s(e){Rx.Observable.zip(Rx.Observable.from(e.pendingResults()),Rx.Observable.interval(2e3)).subscribe({next:function(t){var r=o(t,1),n=r[0];axios.get("/api/v0/result/"+n.image_id).then(function(t){var r=t.data;e.getStatus(n.image_id)!==r.status&&(e.setStatus(n.image_id,r.status),"done"===r.status&&(e.setResultByImageId(n.image_id,r.result),e.save()),i(e))})},error:function(e){},complete:function(){setTimeout(function(){return s(e)},2e3)}})}var o=function(){function e(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(a)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=function(){function e(){r(this,e),this.key="results",this.arr=[]}return u(e,[{key:"remove",value:function(e){this.arr=this.arr.filter(function(t){return t.image_id!==e}),this.save()}},{key:"add",value:function(e){this.arr.push(e),this.save()}},{key:"save",value:function(){localStorage&&localStorage.setItem(this.key,JSON.stringify(this.arr))}},{key:"getStatus",value:function(e){var t=!0,r=!1,n=void 0;try{for(var a,i=this.arr[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var s=a.value;if(s.image_id===e)return s.status}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}return null}},{key:"setStatus",value:function(e,t){var r=!0,n=!1,a=void 0;try{for(var i,s=this.arr[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var o=i.value;o.image_id===e&&(o.status=t)}}catch(e){n=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw a}}}},{key:"setResultByImageId",value:function(e,t){for(var r=0;r<this.arr.length;r++)this.arr[r].image_id===e&&(this.arr[r].result=t,this.arr[r].status="done")}},{key:"validate",value:function(e){return Array.isArray(e)}},{key:"toList",value:function(){return this.arr}},{key:"pendingResults",value:function(){return this.arr.filter(function(e){return["pending","processing"].indexOf(e.status)>=0})}},{key:"load",value:function(){if(localStorage)try{var e=JSON.parse(localStorage.getItem(this.key));e||(e=[{status:"done",image_url:"https://flower.jackhftang.com/storage/img/L5UgLRlpweO2640te2H1O82TQQraCFD2RUnbeMrT.jpeg",image_id:"XJPNM6wm8MxS58U6I463Vx5EtvdPxXGn4zThS0Njtf1S2CllndVH8eefAPUl",result:[{class:"barbeton daisy",score:.00028989833663217723},{class:"sweet william",score:.00033965110196731985},{class:"king protea",score:.0008190097287297249},{class:"gazania",score:.0022952156141400337},{class:"passion flower",score:.993553638458252}]}]),this.validate(e)&&(this.arr=e)}catch(e){}}}]),e}();window.renderResults=i;var c=new l;c.load(),i(c),s(c),$('input[type="file"]').on("change",function(e){var t=this.files[0];if(t){var r=new FormData;r.append("image",t.slice(),t.name),axios.post("/api/v0/request",r,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){c.add(e.data),i(c)}),this.form.reset()}})}});